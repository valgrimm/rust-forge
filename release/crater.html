<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Triaging Crater Runs - Rust Forge</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Supplemental documentation for contributing to The Rust Programming Language">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="affix"><a href="../index.html">Overview</a></li><li><a href="../chat/index.html">Chat Platforms</a></li><li><ol class="section"><li><a href="../chat/zulip.html">Zulip</a></li><li><ol class="section"><li><a href="../chat/zulip/moderation.html">Moderation</a></li></ol></li><li><a href="../chat/discord.html">Discord</a></li></ol></li><li><a href="../core/index.html">Core</a></li><li><ol class="section"><li><a href="../core/blogs.html">Rust Blog Guidelines</a></li></ol></li><li><a href="../community/index.html">Community</a></li><li><ol class="section"><li><a href="../community/survey-faq.html">State of Rust Survey FAQ</a></li></ol></li><li><a href="../compiler/index.html">Compiler</a></li><li><ol class="section"><li><a href="../compiler/cross-compilation/index.html">Cross Compilation</a></li><li><ol class="section"><li><a href="../compiler/cross-compilation/windows.html">Windows</a></li></ol></li><li><a href="../compiler/triage-meeting.html">Triage Meeting</a></li><li><a href="../compiler/steering-meeting.html">Steering Meeting</a></li><li><ol class="section"><li><a href="../compiler/steering-meeting/submit.html">Submitting a proposal</a></li><li><a href="../compiler/steering-meeting/how-to-run-planning.html">How to run the planning meeting</a></li><li><a href="../compiler/steering-meeting/how-to-run-design.html">How to run a design meeting</a></li></ol></li></ol></li><li><a href="../governance/index.html">Governance</a></li><li><a href="../infra/index.html">Infrastructure</a></li><li><ol class="section"><li><a href="../infra/other-installation-methods.html">Other Installation Methods</a></li><li><a href="../infra/channel-layout.html">Release Channel Layout</a></li><li><a href="../infra/service-infrastructure.html">Service Infrastructure</a></li><li><a href="../infra/team-maintenance.html">Team Maintenance</a></li><li><a href="../infra/toolstate.html">The Toolstate System</a></li><li><a href="../infra/policies/index.html">Policies</a></li><li><ol class="section"><li><a href="../infra/policies/broken-nightlies.html">Broken nightlies</a></li></ol></li><li><a href="../infra/guidelines/index.html">Guidelines</a></li><li><ol class="section"><li><a href="../infra/guidelines/static-websites.html">Static websites</a></li></ol></li><li><a href="../infra/docs/index.html">Documentation</a></li><li><ol class="section"><li><a href="../infra/docs/aws-access.html">AWS access for team members</a></li><li><a href="../infra/docs/bastion.html">Bastion server</a></li><li><a href="../infra/docs/crater-agents.html">Crater agents</a></li><li><a href="../infra/docs/discord-mods-bot.html">Discord moderation bot</a></li><li><a href="../infra/docs/dns.html">Domain names and DNS</a></li><li><a href="../infra/docs/docs-rs.html">docs.rs</a></li><li><a href="../infra/docs/monitoring.html">Monitoring</a></li><li><a href="../infra/docs/rust-bots.html">rust-bots server</a></li><li><a href="../infra/docs/rustc-ci.html">rust-lang/rust CI</a></li></ol></li></ol></li><li><a href="../lang/index.html">Language</a></li><li><ol class="section"><li><a href="../lang/rfc-merge-procedure.html">RFC Merge Procedure</a></li><li><a href="../lang/triage-meeting-procedure.html">Triage Meeting Procedure</a></li></ol></li><li><a href="../libs/index.html">Libs</a></li><li><ol class="section"><li><a href="../libs/maintaining-std.html">Maintaining the standard library</a></li></ol></li><li><a href="../release/index.html">Release</a></li><li><ol class="section"><li><a href="../release/beta-backporting.html">Beta Backporting</a></li><li><a href="../release/platform-support.html">Platform Support</a></li><li><a href="../release/release-notes.html">Preparing Release Notes</a></li><li><a href="../release/process.html">Release Process</a></li><li><a href="../release/rollups.html">Rollup Procedure</a></li><li><a href="../release/triage-procedure.html">Triage Procedure</a></li><li><a href="../release/crater.html" class="active">Triaging Crater Runs</a></li></ol></li><li><a href="../archive/index.html">Archive</a></li><li><ol class="section"><li><a href="../archive/fott.html">Friends of the Tree</a></li><li><a href="../archive/release-history.html">Release History</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Rust Forge</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                            <a href="https://github.com/rust-lang/rust-forge" title="Git repository" aria-label="Git repository">
                                <i id="git-repository-button" class="fa fa-github"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#triaging-crater-runs" id="triaging-crater-runs">Triaging Crater Runs</a></h1>
<h2><a class="header" href="#running-crater" id="running-crater">Running crater</a></h2>
<p>We regularly run Crater runs, and this documents the procedure for triaging a beta run; it may also
be applicable to non-release team runs (e.g., PR crater runs) with minor modifications.</p>
<p>First, file a new issue titled &quot;Crater runs for 1.x&quot; (<a href="https://github.com/rust-lang/rust/issues/66244">example</a>)</p>
<p>A crater run for beta should be started as soon as we have beta out. Use the following craterbot
invocations.</p>
<p>$BETA_VERSION is e.g. 1.40.0-1, increment the 1 if it's not the first beta crater run, you can also
use the auto-incremented counter on the beta <code>rustc --version</code>.</p>
<p>$STABLE is e.g. 1.39.0 (the stable release)
$BETA is beta-YYYY-MM-DD, get the date by looking at https://static.rust-lang.org/manifests.txt and
get the date of the most recent channel-rust-beta.toml.</p>
<pre><code>@craterbot run name=beta-$BETA_VERSION start=$STABLE end=$BETA mode=build-and-test cap-lints=warn p=10
@craterbot run name=beta-rustdoc-$BETA_VERSION start=$STABLE end=$BETA mode=rustdoc cap-lints=warn p=5
</code></pre>
<p>Once the runs complete, you want to triage them</p>
<h2><a class="header" href="#triaging" id="triaging">Triaging</a></h2>
<p>These steps should generally be done for the normal rustc run, and then followed up by a triage of
the rustdoc run. Ignore failures in rustdoc that look to be rooted in rustc (i.e., duplicate
failures).</p>
<p>There will usually be quite a few regressions -- there are a couple tools that can help reduce the
amount of work that you need to do. It's mostly a matter of personal preference which is more
helpful.</p>
<ul>
<li>https://github.com/Mark-Simulacrum/crater-generate-report/
<ul>
<li>This groups regressions by 'root' by parsing the logs to look for the compilation failed
messages printed by Cargo</li>
</ul>
</li>
<li>https://github.com/Centril/crater-cat-errors
<ul>
<li>This groups regressions by the &quot;error&quot; message, also by parsing logs</li>
</ul>
</li>
</ul>
<p>If you've written a tool, feel free to add it here! We're still figuring out what the best UI for
this is.</p>
<p>Regardless of the tool you've run, you ultimately need to read through a bunch of logs and try to
quickly determine if they're genuine failures or spurious. Most of the time, a compiler failure is
genuine, and test failures are mostly spurious, but this usually requires some level of guessing.</p>
<p>Once you've determined that something is a genuine failure, add it to a list somewhere (local file,
HackMD, whatever) with the error &quot;category.&quot; Mostly, you're trying to group things such that the
regressions in a single group are all caused by the same set of commits, and different groups have
different causes.</p>
<p>Once this is done, and you have all the regressions triaged into their separate groups, you want to
file a new issue for each group. It should have the <code>regression-from-stable-to-beta</code> and
<code>T-compiler</code> label by default, possibly <code>T-libs</code> if it's a standard library regression, but that's
relatively rare. If you happen to think you know the PR that caused the failure, cc the PR author in
a separate comment and link to the PR; otherwise compiler team will triage the issue soon.</p>
<p>Leave a comment on the original issue with the crater runs linking to all the issues you just
opened, ideally with the issue titles as well.</p>
<p>You're done!</p>
<h2><a class="header" href="#re-running-rustc-on-a-crate" id="re-running-rustc-on-a-crate">Re-running rustc on a crate</a></h2>
<p>For the crates which we're not sure about, you can try running crater locally, or build the crate
directly (<a href="https://gist.githubusercontent.com/lqd/4a8af10389d10840d90655c109df5eac/raw/1bb8ac86e211b745b1674041bc725a859b390c3c/cratesio-curl"><code>cratesio-curl</code></a> can be helpful). Be careful -- regardless of what you do, you are running arbitrary code locally. It's
also fine to file issues for the crates you're not sure about and let the triage process naturally
categorize the error, though it's not good to do this for <em>all</em> the crates. Once you've triaged a
crater run a couple times you get a pretty good sense of what is spurious and what isn't, too.</p>
<p>You can run crater on just a single crate by doing something like this (at least, as of now).
Note that this will download several gigabytes (on first use) and requires Docker to be running.</p>
<pre><code>git clone https://github.com/rust-lang/crater
cd crater
cargo run -- prepare-local
CRATES=&quot;crates-io-crate-0.4.0,owner/repository-name&quot; # Edit this.
cargo run -- define-ex --crate-select=list:$CRATES --cap-lints=forbid 1.38.0 beta # Edit the stable version.
cargo run -- run-graph --threads 4
cargo run -- gen-report work/ex/default/
# view report for this crate
</code></pre>
<p>It's also possible to re-queue a subset of crates onto the official builders, for which that take a
look at: https://gist.github.com/ecstatic-morse/be799bfa4d3b3d6e163fa61a9c30706f</p>
<h2><a class="header" href="#determining-the-root-cause-of-the-regression" id="determining-the-root-cause-of-the-regression">Determining the root cause of the regression</a></h2>
<p>It's not always apparent why a crate stopped building. This isn't generally something done as part
of crater triage -- but can be a good followup. Here, <a href="https://github.com/rust-lang/cargo-bisect-rustc"><code>cargo-bisect-rustc</code></a> and Felix's
<a href="http://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/">minimization guide</a> are excellent tools to apply.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../release/triage-procedure.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../archive/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../release/triage-procedure.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../archive/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../js/moment.min.js"></script>
        
        <script type="text/javascript" src="../js/index.js"></script>
        

        

    </body>
</html>
